extends layout

block content
    include top_marked
    include header
    include top_button
    link(rel='stylesheet', href='/stylesheets/music_detail.css')
    script(src="/javascripts/music_detail.js")
    script(src="/javascripts/music_detail_play.js")
    - var len = music.comments.length
    - var page_num = Math.ceil(music.commentN / 10)
    - var commentnum = 10
    if music.commentN >= 10 
        -commentnum = 10
    if music.commentN < 10
        -commentnum = music.commentN
    div.page-content
        div.top_view
            div.music_poster
                img.ui.fluid.image.myimage(src='/resources/images/#{music.cover}')
            div.music_detail
                div.evaluate
                    div.ui.star.rating(data-rating="4")
                div.music_message
                    p 歌曲名字: #{music.name}
                    p 歌曲作者: #{music.author.username}
                    p 歌曲标签: 
                        each tag in music.tags
                            span #{tag.tag_name}
                    p 发行时间: #{music.date}
                div.right_message(style="padding-top:10px;")
                    button.circular.ui.icon.button.right_button
                        i.share.icon
                        分享
                    if user
                        if music.author._id == user._id    
                            button.circular.ui.icon.button.right_button(style="margin-left:10px;")
                                i.paint.brush.icon
                                编辑音乐信息
        div.middle_view
            div.ui.labeled.button(tabindex="0")
                div.ui.red.button
                    i.heart.icon
                    span 试听
                a.ui.basic.left.pointing.label(id="listenN") #{music.listenN}
            if user
                if user.is_collect
                    div.ui.labeled.button(tabindex="0")
                        div.ui.red.button
                            i.save.icon
                            span 已收藏
                        a.ui.basic.left.pointing.label #{music.collectN}
                else
                    div.ui.labeled.button(tabindex="0",id="collect")
                        div.ui.red.button
                            i.save.icon
                            span 收藏
                        a.ui.basic.left.pointing.label(id="collectN") #{music.collectN}
            div.ui.labeled.button(tabindex="0")
                div.ui.red.button
                    i.comments.icon
                    span 评论
                a.ui.basic.left.pointing.label(id="commentN") #{music.commentN}
            if music.is_spectrum_public == true
                div.ui.labeled.button(tabindex="0")
                    div.ui.red.button
                        i.heart.icon
                        a(href="") 编辑
        div.bottom_view
            div.ui.comments
                h3.ui.dividing.header(id="commentN2") #{music.commentN}评论
            div.send_comment
                div.comment_head
                    img.ui.circular.image.pos(src='/resources/images/default_head.jpg')
                textarea.submit-textarea(id="content",rows="3" cols="20")
                button.submit-button(id = "submit_button",style="background-color:#00b5e5") 发表评论
            div.ui.dividing.header.divideline
            div.my_comment(id = "comment_all")
                - for(var x = 1; x <= commentnum; x++)
                    div.comment
                        div.comment_head
                            img.ui.circular.image.pos(src='/resources/images/default_head.jpg')
                        div.all_content
                            div.name
                                p.description #{music.comments[len-x].comment_userId.username}
                            div.content
                                p.description #{music.comments[len-x].comment_content}
                            div.message
                                - var high = len-x+1
                                span.qua ##{high}
                                span.qua #{music.comments[len-x].comment_date}
                        div.all
                            //div.cha 查看全部
                    div.ui.dividing.header.divideline
            div.next_page(id="next_page")
                //span 共#{page_num}页
                //    - for (var x = 1; x <= page_num; x++)
                //        //span.qua(style="color:blue;") #{x}
                //        a #{x}
                //span 下一页


    script.
        window.music = !{JSON.stringify(music)};
        window.user = !{JSON.stringify(user)};
        console.log(music);
        console.log(user);

    include footer
    include music_player